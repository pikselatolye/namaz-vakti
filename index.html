<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Ankara Namaz Vakitleri - iPad Pro</title>
  <style>
    :root {
      --bg: #050914;
      --card-bg: rgba(255, 255, 255, 0.08);
      --text: #f5f8ff;
      --muted: rgba(255, 255, 255, 0.6);
      --accent: #7aa2ff;
      --accent2: #8dffa8;
      --danger: #ff6b6b;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      width: 100vw;
      overflow: hidden; /* Kaydırmayı engelle */
      display: flex;
      flex-direction: column;
    }

    .wrap {
      display: flex;
      flex-direction: column;
      height: 100vh;
      padding: 1.5vh;
      gap: 1.5vh;
    }

    /* Üst Panel - Yüksekliğin %18'i */
    .header {
      height: 18vh;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 3vh;
      background: var(--card-bg);
      border-radius: 2vh;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .title-area h1 { font-size: 4vh; margin: 0; font-weight: 800; }
    .title-area p { font-size: 2vh; margin: 0.5vh 0; color: var(--muted); }
    .clock { font-size: 9vh; font-weight: 900; font-variant-numeric: tabular-nums; color: var(--text); }

    /* Sıradaki Vakit - Yüksekliğin %12'si */
    .next-vakit {
      height: 12vh;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 4vh;
      background: linear-gradient(90deg, rgba(122,162,255,0.15), transparent);
      border-radius: 2vh;
      border: 1px solid rgba(122,162,255,0.2);
    }
    .next-label { font-size: 1.8vh; font-weight: 800; color: var(--accent); text-transform: uppercase; }
    .next-name { font-size: 4.5vh; font-weight: 900; }
    .countdown { font-size: 5.5vh; font-weight: 900; color: var(--accent2); }

    /* Kutular Izgarası - Geriye kalan %65-70'i kaplar */
    .tiles-grid {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 1.5vh;
    }

    .tile {
      background: var(--card-bg);
      border-radius: 2.5vh;
      border: 1px solid rgba(255,255,255,0.1);
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      align-items: center;
      padding: 0 4vh;
      transition: all 0.3s ease;
    }

    .tile.active {
      border: 3px solid var(--accent);
      background: rgba(122, 162, 255, 0.1);
    }

    .t-name { font-size: 4vh; font-weight: 700; color: var(--muted); }
    .t-time { font-size: 8vh; font-weight: 900; }

    /* Pills */
    .pill { font-size: 1.6vh; padding: 0.5vh 1.5vh; border-radius: 1vh; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); margin-right: 1vh; }
    .pill.kerahat { background: rgba(255, 107, 107, 0.2); color: var(--danger); border-color: var(--danger); display: none; }

    /* Overlay */
    .overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.95);
      display: none; z-index: 100; flex-direction: column;
      align-items: center; justify-content: center;
    }
    .overlay.show { display: flex; }
    .ov-name { font-size: 12vh; font-weight: 900; color: var(--accent); }

    /* Portre Modu (iPad dikey tutulursa) */
    @media (orientation: portrait) {
      .tiles-grid { grid-template-columns: 1fr; grid-template-rows: repeat(6, 1fr); }
      .tile { padding: 0 5vh; }
      .t-time { font-size: 7vh; }
    }
  </style>
</head>
<body>

  <div class="wrap">
    <div class="header">
      <div class="title-area">
        <h1>Ankara</h1>
        <p id="dateLine">-- Şubat 2026</p>
        <div style="display:flex; margin-top:1vh;">
          <span class="pill" id="statusPill">...</span>
          <span class="pill kerahat" id="kerahatPill">⚠️ KERAHAT</span>
        </div>
      </div>
      <div class="clock" id="clock">00:00</div>
    </div>

    <div class="next-vakit">
      <div>
        <div class="next-label">Sıradaki Vakit</div>
        <div class="next-name" id="nextName">--</div>
      </div>
      <div style="text-align: right;">
        <div class="next-label">Kalan Süre</div>
        <div class="countdown" id="countdown">00:00:00</div>
      </div>
    </div>

    <div class="tiles-grid" id="tilesGrid">
      </div>
  </div>

  <div class="overlay" id="overlay">
    <div style="font-size: 4vh; color: var(--muted);">VAKİT GİRDİ</div>
    <div class="ov-name" id="ovName">--</div>
  </div>

<script>
(function(){
  const PRAYERS = [
    { key:"Imsak", tr:"İmsak" }, { key:"Gunes", tr:"Güneş" }, { key:"Ogle", tr:"Öğle" },
    { key:"Ikindi", tr:"İkindi" }, { key:"Aksam", tr:"Akşam" }, { key:"Yatsi", tr:"Yatsı" }
  ];

  let state = { data: null, lastMinute: -1 };
  const el = id => document.getElementById(id);
  const pad = n => String(n).padStart(2, '0');

  function parseTime(timeStr, baseDate = new Date()) {
    if(!timeStr) return new Date();
    const [h, m] = timeStr.split(':').map(Number);
    const d = new Date(baseDate);
    d.setHours(h, m, 0, 0);
    return d;
  }

  function loadData() {
    fetch(`vakit.json?v=${new Date().getTime()}`)
      .then(r => r.json())
      .then(json => {
        state.data = json;
        localStorage.setItem('cached_vakit', JSON.stringify(json));
        init();
      })
      .catch(() => {
        const cached = localStorage.getItem('cached_vakit');
        if(cached) {
          state.data = JSON.parse(cached);
          el('statusPill').textContent = "OFFLINE";
          init();
        }
      });
  }

  function init() {
    renderTiles();
    loop();
    setInterval(loop, 1000);
  }

  function renderTiles() {
    el('tilesGrid').innerHTML = PRAYERS.map(p => `
      <div class="tile" id="tile-${p.key}">
        <div class="t-name">${p.tr}</div>
        <div class="t-time">${state.data.today[p.key]}</div>
      </div>
    `).join('');
    el('dateLine').textContent = state.data.today.MiladiTarihUzun || "";
    if(el('statusPill').textContent === "...") el('statusPill').textContent = "GÜNCEL";
  }

  function loop() {
    const now = new Date();
    el('clock').textContent = pad(now.getHours()) + ":" + pad(now.getMinutes());
    
    // Geri Sayım
    const times = state.data.today;
    let next = null;
    const order = ["Imsak", "Ogle", "Ikindi", "Aksam", "Yatsi"];
    for (let key of order) {
      let t = parseTime(times[key]);
      if (t > now) { next = { k: key, t: t }; break; }
    }
    if (!next) {
      let tomorrow = new Date(now); tomorrow.setDate(tomorrow.getDate() + 1);
      next = { k: "Imsak", t: parseTime(times.Imsak, tomorrow) };
    }

    const diff = next.t - now;
    const h = Math.floor(diff / 3600000);
    const m = Math.floor((diff % 3600000) / 60000);
    const s = Math.floor((diff % 60000) / 1000);
    el('countdown').textContent = `${pad(h)}:${pad(m)}:${pad(s)}`;
    el('nextName').textContent = PRAYERS.find(p => p.key === next.k).tr;

    // Aktif Kutuyu İşaretle
    PRAYERS.forEach(p => el(`tile-${p.key}`).classList.remove('active'));
    el(`tile-${next.k}`).classList.add('active');

    // Dakika başı kontroller (Kerahat & Overlay)
    if (now.getMinutes() !== state.lastMinute) {
      const gunes = parseTime(times.Gunes);
      const aksam = parseTime(times.Aksam);
      const isKerahat = (now > gunes && now < new Date(gunes.getTime() + 45*60000)) || 
                        (now > new Date(aksam.getTime() - 45*60000) && now < aksam);
      el('kerahatPill').style.display = isKerahat ? "inline-block" : "none";

      const timeStr = pad(now.getHours()) + ":" + pad(now.getMinutes());
      PRAYERS.forEach(p => {
        if(times[p.key] === timeStr) {
          el('ovName').textContent = p.tr;
          el('overlay').classList.add('show');
          setTimeout(() => el('overlay').classList.remove('show'), 60000);
        }
      });
      state.lastMinute = now.getMinutes();
    }
  }

  loadData();
})();
</script>
</body>
</html>
