<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Ankara Vakit Panosu</title>
  <style>
    :root {
      --bg: #050914;
      --card-bg: rgba(255, 255, 255, 0.07);
      --text: #f5f8ff;
      --muted: rgba(255, 255, 255, 0.45);
      --accent: #7aa2ff;
      --accent2: #8dffa8;
      --danger: #ff6b6b;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0; background: var(--bg); color: var(--text);
      height: 100vh; width: 100vw; overflow: hidden;
      display: flex; flex-direction: column;
    }

    .wrap {
      display: flex; flex-direction: column;
      height: 100vh; padding: 2vh; gap: 1.5vh;
    }

    /* Üst Başlık */
    .header {
      height: 16vh; display: flex; justify-content: space-between; align-items: center;
      padding: 0 4vh; background: var(--card-bg); border-radius: 2.5vh;
    }
    .clock { font-size: 10vh; font-weight: 900; font-variant-numeric: tabular-nums; }
    .title-area h1 { font-size: 3.8vh; margin: 0; font-weight: 800; }
    .title-area p { font-size: 2vh; color: var(--muted); margin: 0.5vh 0; }

    /* Sıradaki Vakit */
    .next-vakit {
      height: 13vh; display: flex; justify-content: space-between; align-items: center;
      padding: 0 5vh; background: rgba(122,162,255,0.12); border-radius: 2.5vh;
      border: 1px solid rgba(122,162,255,0.2);
    }
    .next-name { font-size: 4.5vh; font-weight: 900; }
    .countdown { font-size: 6vh; font-weight: 900; color: var(--accent2); }

    /* Vakit Kutuları */
    .tiles-grid {
      flex: 1; display: grid; gap: 1.2vh;
      grid-template-columns: 1fr; /* Dikeyde tek sütun */
    }

    .tile {
      background: var(--card-bg); border-radius: 2.2vh;
      display: flex; flex-direction: row; /* HER ZAMAN YAN YANA */
      justify-content: space-between; align-items: center;
      padding: 0 5vh; border: 1px solid rgba(255,255,255,0.05);
    }

    .tile.active {
      border: 3px solid var(--accent);
      background: rgba(122, 162, 255, 0.15);
    }

    .t-name { font-size: 4.2vh; font-weight: 700; color: var(--text); }
    .t-time { font-size: 8vh; font-weight: 900; color: var(--accent); }

    /* iPad 2 Yatay (Landscape) için 2 sütunlu düzen */
    @media (orientation: landscape) {
      .tiles-grid {
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(3, 1fr);
      }
      .t-time { font-size: 8.5vh; }
    }

    .pill { font-size: 1.6vh; padding: 0.5vh 1.5vh; border-radius: 1vh; background: rgba(255,255,255,0.05); color: var(--muted); }
    .kerahat-pill {
      font-size: 2vh; font-weight: bold; color: var(--danger);
      background: rgba(255,107,107,0.1); border: 1px solid var(--danger);
      padding: 0.5vh 2vh; border-radius: 1.5vh; display: none; margin-top: 1vh;
    }

    /* Overlay */
    .overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.95);
      display: none; z-index: 100; flex-direction: column;
      align-items: center; justify-content: center;
    }
    .overlay.show { display: flex; }
  </style>
</head>
<body>

  <div class="wrap">
    <div class="header">
      <div class="title-area">
        <h1>Ankara Namaz Vakitleri</h1>
        <p id="dateLine">-- Şubat 2026</p>
        <div style="display:flex; gap:1vh;">
          <span class="pill" id="updateInfo">Güncelleniyor...</span>
          <div id="kerahatPill" class="kerahat-pill">⚠️ KERAHAT VAKTİ</div>
        </div>
      </div>
      <div class="clock" id="clock">00:00</div>
    </div>

    <div class="next-vakit">
      <div>
        <div style="font-size:1.8vh; color:var(--muted); font-weight:800;">SIRADAKİ</div>
        <div class="next-name" id="nextName">--</div>
      </div>
      <div style="text-align: right;">
        <div style="font-size:1.8vh; color:var(--muted); font-weight:800;">KALAN</div>
        <div class="countdown" id="countdown">00:00:00</div>
      </div>
    </div>

    <div class="tiles-grid" id="tilesGrid">
      </div>
  </div>

  <div class="overlay" id="overlay">
    <div style="font-size: 14vh; font-weight: 900; color: var(--accent);" id="ovName">--</div>
    <div style="font-size: 4vh; color: var(--muted);">Vakit Girdi</div>
  </div>

<script>
(function(){
  const PRAYERS = [
    { key:"Imsak", tr:"İmsak" }, { key:"Gunes", tr:"Güneş" }, { key:"Ogle", tr:"Öğle" },
    { key:"Ikindi", tr:"İkindi" }, { key:"Aksam", tr:"Akşam" }, { key:"Yatsi", tr:"Yatsı" }
  ];

  let state = { data: null, lastMin: -1 };
  const el = id => document.getElementById(id);
  const pad = n => String(n).padStart(2, '0');

  function loadData() {
    fetch(`vakit.json?v=${Date.now()}`)
      .then(r => r.json())
      .then(json => {
        state.data = json;
        render();
        tick();
        setInterval(tick, 1000);
      })
      .catch(() => {
        const cached = localStorage.getItem('cached_vakit');
        if(cached) { state.data = JSON.parse(cached); render(); tick(); setInterval(tick, 1000); }
      });
  }

  function render() {
    el('tilesGrid').innerHTML = PRAYERS.map(p => `
      <div class="tile" id="tile-${p.key}">
        <div class="t-name">${p.tr}</div>
        <div class="t-time">${state.data.today[p.key]}</div>
      </div>
    `).join('');
    el('dateLine').textContent = state.data.today.MiladiTarihUzun || "";
    el('updateInfo').textContent = "Veri Kaynağı: Ankara";
  }

  function tick() {
    const now = new Date();
    const clockStr = pad(now.getHours()) + ":" + pad(now.getMinutes());
    el('clock').textContent = clockStr;

    const times = state.data.today;
    let next = null;
    const order = ["Imsak", "Ogle", "Ikindi", "Aksam", "Yatsi"];
    
    for (let key of order) {
      let [h, m] = times[key].split(':').map(Number);
      let t = new Date(now); t.setHours(h, m, 0, 0);
      if (t > now) { next = { k: key, t: t }; break; }
    }
    
    if (!next) {
      let tomorrow = new Date(now); tomorrow.setDate(tomorrow.getDate() + 1);
      let [h, m] = times.Imsak.split(':').map(Number);
      next = { k: "Imsak", t: new Date(tomorrow.setHours(h, m, 0, 0)) };
    }

    const diff = next.t - now;
    const h = Math.floor(diff / 3600000);
    const m = Math.floor((diff % 3600000) / 60000);
    const s = Math.floor((diff % 60000) / 1000);
    el('countdown').textContent = `${pad(h)}:${pad(m)}:${pad(s)}`;
    el('nextName').textContent = PRAYERS.find(p => p.key === next.k).tr + " • " + times[next.k];

    PRAYERS.forEach(p => el(`tile-${p.key}`).classList.remove('active'));
    el(`tile-${next.k}`).classList.add('active');

    if (now.getMinutes() !== state.lastMin) {
      state.lastMin = now.getMinutes();
      // Kerahat
      const [gh, gm] = times.Gunes.split(':').map(Number);
      const [ah, am] = times.Aksam.split(':').map(Number);
      const gunesT = new Date(now).setHours(gh, gm, 0, 0);
      const aksamT = new Date(now).setHours(ah, am, 0, 0);
      const isKerahat = (now > gunesT && now < (gunesT + 45*60000)) || 
                        (now > (aksamT - 45*60000) && now < aksamT);
      el('kerahatPill').style.display = isKerahat ? "block" : "none";

      // Vakit Girdi
      PRAYERS.forEach(p => {
        if(times[p.key] === clockStr) {
          el('ovName').textContent = p.tr;
          el('overlay').classList.add('show');
          setTimeout(() => el('overlay').classList.remove('show'), 60000);
        }
      });
    }
  }

  loadData();
})();
</script>
</body>
</html>

