<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Ankara Namaz Vakitleri</title>

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Namaz Vakti">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no">
  <meta name="format-detection" content="date=no">
  <meta name="format-detection" content="address=no">
  <meta name="format-detection" content="email=no">

  <style>
    :root{
      --bg0:#070b14; --bg1:#0b1220;
      --line:rgba(255,255,255,.14);
      --muted:rgba(234,240,255,.78);
      --text:#f3f7ff;
      --accent:#7aa2ff;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
    }
    html, body { height:100%; }
    body{
      margin:0; height:100%;
      background:var(--bg0); color:var(--text);
      -webkit-text-size-adjust:100%;
      overflow:hidden;
    }
    *{-webkit-tap-highlight-color:rgba(0,0,0,0); box-sizing:border-box;}

    .topbar{
      height:8px;
      background:linear-gradient(90deg, rgba(122,162,255,.98), rgba(141,255,168,.92), rgba(255,204,102,.92));
      opacity:.9;
    }

    .wrap{
      height:calc(100% - 8px);
      padding:14px 14px 12px;
      display:flex;
      flex-direction:column;
      gap:10px;
      background:
        radial-gradient(1200px 700px at 20% -10%, rgba(122,162,255,.18), transparent 55%),
        radial-gradient(900px 600px at 90% 0%, rgba(141,255,168,.12), transparent 55%),
        linear-gradient(180deg, #0b1220 0%, #070b14 100%);
    }

    .card{
      border:1px solid var(--line);
      border-radius:18px;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.18));
      box-shadow:0 10px 26px rgba(0,0,0,.28);
    }

    /* Header */
    .header{
      padding:12px 12px;
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:10px;
      min-height:78px;
    }
    .title{font-size:20px;font-weight:900;letter-spacing:.2px;}
    .sub{margin-top:6px;font-size:13px;color:var(--muted);line-height:1.25;}
    .pills{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;}
    .pill{
      border:1px solid rgba(255,255,255,.16);
      background:rgba(0,0,0,.22);
      padding:6px 10px;border-radius:999px;
      font-size:12px;color:rgba(255,255,255,.82);
      white-space:nowrap;
    }
    .dot{
      display:inline-block;width:8px;height:8px;border-radius:99px;margin-right:7px;
      background:var(--accent);vertical-align:middle;opacity:.95;
      box-shadow:0 0 0 3px rgba(122,162,255,.14);
    }
    .clock{
      font-size:52px;font-weight:900;letter-spacing:1px;line-height:1;
      text-align:right;font-variant-numeric:tabular-nums;
      text-shadow:0 2px 14px rgba(0,0,0,.35);
      padding-top:2px;
      min-width:128px;
    }

    /* Next strip */
    .next{
      padding:10px 12px;
      background:linear-gradient(180deg, rgba(122,162,255,.16), rgba(0,0,0,.18));
      min-height:58px;
    }
    .nextgrid{display:flex;justify-content:space-between;align-items:center;gap:10px;}
    .label{font-size:12px;color:var(--muted);font-weight:800;}
    .nextPrayer{font-size:22px;font-weight:900;margin-top:3px;}
    .countdown{
      font-size:22px;font-weight:900;margin-top:3px;
      font-variant-numeric:tabular-nums;
      text-shadow:0 2px 14px rgba(0,0,0,.35);
    }

    /* Tiles (Flexbox 2x3) */
    .tilesCard{
      flex:1;
      padding:10px;
      min-height:0;
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .tilesWrap{
      flex:1;
      min-height:0;
      display:flex;
      flex-direction:row;
      flex-wrap:wrap;          /* 2 sütun */
      align-content:stretch;   /* 3 satıra yay */
      margin:-5px;             /* gap simülasyonu */
    }

    .tile{
      width:50%;               /* 2 sütun kesin */
      padding:5px;             /* gap simülasyonu */
    }

    .tileInner{
      height:100%;
      border:1px solid rgba(255,255,255,.12);
      border-radius:16px;
      background:rgba(255,255,255,.06);
      box-shadow:0 8px 22px rgba(0,0,0,.22);
      display:flex;
      flex-direction:column;
      justify-content:center;
      padding:12px 12px;
      position:relative;
      overflow:hidden;
    }

    /* 6 tile: her biri 1/3 yükseklik, iOS9 uyumlu */
    .tileInner{
      min-height:0;
    }
    .tile{ height:33.3333%; }  /* 3 satır kesin */

    .tileInner:before{
      content:"";
      position:absolute; inset:-60px -60px auto auto;
      width:140px; height:140px;
      background:radial-gradient(circle at 30% 30%, rgba(122,162,255,.18), transparent 60%);
      transform:rotate(18deg);
      pointer-events:none;
    }

    .tname{
      font-size:18px;
      font-weight:900;
      letter-spacing:.2px;
      color:rgba(243,247,255,.92);
      margin-bottom:6px;
    }
    .ttime{
      font-size:34px;
      font-weight:900;
      letter-spacing:1px;
      font-variant-numeric:tabular-nums;
      text-shadow:0 2px 14px rgba(0,0,0,.35);
    }

    .active .tileInner{
      border-color:rgba(122,162,255,.70);
      background:rgba(122,162,255,.16);
      box-shadow:0 0 0 2px rgba(122,162,255,.16) inset, 0 10px 26px rgba(0,0,0,.28);
    }

    .err{
      font-size:12px;
      color:rgba(255,190,190,.98);
      font-weight:700;
      padding:0 2px;
    }

    .footer{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      padding:0 2px;
      color:rgba(234,240,255,.58);
      font-size:11px;
      line-height:1.2;
      min-height:18px;
    }
    .rightFooter{white-space:nowrap;}
  </style>
</head>

<body>
  <div class="topbar"></div>

  <div class="wrap">
    <div class="card header">
      <div style="min-width:0">
        <div class="title">Ankara • Namaz Vakitleri</div>
        <div class="sub" id="dateLine">—</div>
        <div class="pills">
          <div class="pill"><span class="dot"></span><span id="districtPill">İlçe: —</span></div>
          <div class="pill" id="srcPill">Kaynak: —</div>
        </div>
      </div>
      <div class="clock" id="clock">--:--</div>
    </div>

    <div class="card next">
      <div class="nextgrid">
        <div>
          <div class="label">Sıradaki</div>
          <div class="nextPrayer" id="nextPrayer">—</div>
        </div>
        <div style="text-align:right">
          <div class="label">Kalan</div>
          <div class="countdown" id="countdown">--:--:--</div>
        </div>
      </div>
    </div>

    <div class="card tilesCard">
      <div class="tilesWrap" id="tilesWrap"></div>
      <div class="err" id="err"></div>
    </div>

    <div class="footer">
      <div id="statusLine">Güncelleme: —</div>
      <div class="rightFooter">© <span id="copyYear"></span> Ahmet Ensar Kibaroğlu</div>
    </div>
  </div>

<script>
(function(){
  var PRAYERS = [
    { key:"Imsak", tr:"İmsak" },
    { key:"Gunes", tr:"Güneş" },
    { key:"Ogle",  tr:"Öğle"  },
    { key:"Ikindi",tr:"İkindi"},
    { key:"Aksam", tr:"Akşam" },
    { key:"Yatsi", tr:"Yatsı" }
  ];
  var NEXT_ORDER = ["Imsak","Ogle","Ikindi","Aksam","Yatsi"];

  function el(id){ return document.getElementById(id); }
  function pad(n){ n=String(n); return n.length<2 ? "0"+n : n; }
  function fmtClock(d){ return pad(d.getHours()) + ":" + pad(d.getMinutes()); }
  function fmtHMS(ms){
    var s = Math.max(0, Math.floor(ms/1000));
    var hh = Math.floor(s/3600);
    var mm = Math.floor((s%3600)/60);
    var ss = s%60;
    return pad(hh)+":"+pad(mm)+":"+pad(ss);
  }
  function parseHHMM(baseDate, hhmm){
    var parts = String(hhmm||"0:0").split(":");
    var hh = parseInt(parts[0],10) || 0;
    var mm = parseInt(parts[1],10) || 0;
    var d = new Date(baseDate.getTime());
    d.setHours(hh, mm, 0, 0);
    return d;
  }
  function setError(msg){ el("err").textContent = msg || ""; }

  function getJSON(url, onOk, onErr){
    var xhr = new XMLHttpRequest();
    xhr.open("GET", url, true);
    xhr.onreadystatechange = function(){
      if(xhr.readyState !== 4) return;
      if(xhr.status >= 200 && xhr.status < 300){
        try{ onOk(JSON.parse(xhr.responseText)); }
        catch(e){ onErr("JSON parse hatası"); }
      } else {
        onErr("HTTP " + xhr.status);
      }
    };
    xhr.onerror = function(){ onErr("Network error"); };
    xhr.send();
  }

  var data = null;

  function renderTiles(){
    if(!data || !data.today){
      setError("Veri yok.");
      return;
    }
    var t = data.today;

    el("dateLine").textContent = t.MiladiTarihUzun || t.MiladiTarihKisa || "—";
    el("districtPill").textContent = "İlçe: " + (data.district || "ANKARA");
    el("srcPill").textContent = "Kaynak: " + (data.source || "—");
    el("statusLine").textContent = "Güncelleme: " + (data.generatedAt || "—");

    var wrap = el("tilesWrap");
    wrap.innerHTML = "";

    for(var i=0;i<PRAYERS.length;i++){
      var p = PRAYERS[i];
      var time = t[p.key] || "--:--";

      var tile = document.createElement("div");
      tile.className = "tile";
      tile.setAttribute("data-key", p.key);

      var inner = document.createElement("div");
      inner.className = "tileInner";
      inner.innerHTML = '<div class="tname">'+p.tr+'</div><div class="ttime">'+time+'</div>';

      tile.appendChild(inner);
      wrap.appendChild(tile);
    }

    setError("");
  }

  function updateLive(){
    var now = new Date();
    el("clock").textContent = fmtClock(now);
    if(!data || !data.today) return;

    var t = data.today;

    // sıradaki
    var next = null, i, k, at;
    for(i=0;i<NEXT_ORDER.length;i++){
      k = NEXT_ORDER[i];
      at = parseHHMM(now, t[k]);
      if(at.getTime() > now.getTime()){ next = { k:k, at:at }; break; }
    }
    if(!next){
      var tmr = new Date(now.getTime());
      tmr.setDate(tmr.getDate()+1);
      next = { k:"Imsak", at: parseHHMM(tmr, t["Imsak"]) };
    }

    var nameTr = next.k;
    for(i=0;i<PRAYERS.length;i++){ if(PRAYERS[i].key === next.k){ nameTr = PRAYERS[i].tr; break; } }
    el("nextPrayer").textContent = nameTr;
    el("countdown").textContent = fmtHMS(next.at.getTime() - now.getTime());

    // aktif kutu
    var tiles = document.querySelectorAll(".tile");
    for(i=0;i<tiles.length;i++){
      tiles[i].className = tiles[i].className.replace(" active","");
    }

    var bounds = [];
    for(i=0;i<PRAYERS.length;i++){
      bounds.push({ k:PRAYERS[i].key, at: parseHHMM(now, t[PRAYERS[i].key]) });
    }
    bounds.sort(function(a,b){ return a.at - b.at; });

    var active = null;
    for(i=0;i<bounds.length;i++){
      var s = bounds[i].at.getTime();
      var e = (i<bounds.length-1) ? bounds[i+1].at.getTime() : 9999999999999;
      if(now.getTime() >= s && now.getTime() < e){ active = bounds[i].k; break; }
    }
    if(active){
      var node = document.querySelector('.tile[data-key="'+active+'"]');
      if(node) node.className += " active";
    }
  }

  function load(){
    setError("Yükleniyor...");
    getJSON("vakit.json", function(j){
      data = j;
      renderTiles();
      setError("");
    }, function(err){
      setError("Veri alınamadı: " + err + " (vakit.json)");
    });
  }

  el("copyYear").textContent = String(new Date().getFullYear());

  load();
  setInterval(updateLive, 1000);
  updateLive();
})();
</script>
</body>
</html>
