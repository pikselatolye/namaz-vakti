<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Ankara Namaz Vakitleri - iPad Pro</title>
  <style>
    :root {
      --bg: #050914;
      --card-bg: rgba(255, 255, 255, 0.08);
      --text: #f5f8ff;
      --muted: rgba(255, 255, 255, 0.5);
      --accent: #7aa2ff;
      --accent2: #8dffa8;
      --danger: #ff6b6b;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0; background: var(--bg); color: var(--text);
      height: 100vh; width: 100vw; overflow: hidden;
      display: flex; flex-direction: column;
    }

    .wrap {
      display: flex; flex-direction: column;
      height: 100vh; padding: 1.5vh; gap: 1.2vh;
    }

    /* Üst Panel */
    .header {
      height: 16vh; display: flex; justify-content: space-between; align-items: center;
      padding: 0 3vh; background: var(--card-bg); border-radius: 2vh;
    }
    .clock { font-size: 9vh; font-weight: 900; font-variant-numeric: tabular-nums; }
    .title-area h1 { font-size: 3.5vh; margin: 0; }
    .title-area p { font-size: 1.8vh; color: var(--muted); margin-top: 0.5vh; }

    /* Sıradaki Vakit */
    .next-vakit {
      height: 14vh; display: flex; justify-content: space-between; align-items: center;
      padding: 0 4vh; background: rgba(122,162,255,0.1); border-radius: 2vh;
      border: 1px solid rgba(122,162,255,0.2);
    }
    .next-name { font-size: 4.5vh; font-weight: 900; }
    .countdown { font-size: 6vh; font-weight: 900; color: var(--accent2); }

    /* Kutular - Dikeyde bile yan yana düzen */
    .tiles-grid {
      flex: 1; display: grid;
      grid-template-columns: 1fr; /* Her satıra 1 kutu */
      grid-template-rows: repeat(6, 1fr); /* 6 vakit için 6 satır */
      gap: 1vh;
    }

    .tile {
      background: var(--card-bg); border-radius: 2vh;
      display: flex; flex-direction: row; /* İsim ve vakit her zaman yan yana */
      justify-content: space-between; align-items: center;
      padding: 0 4vh; border: 1px solid rgba(255,255,255,0.05);
    }

    .tile.active {
      border: 2px solid var(--accent);
      background: rgba(122, 162, 255, 0.15);
    }

    .t-name { font-size: 3.5vh; font-weight: 700; color: var(--text); }
    .t-time { font-size: 6.5vh; font-weight: 900; color: var(--accent); }

    .pill { font-size: 1.5vh; padding: 0.4vh 1.2vh; border-radius: 1vh; background: rgba(0,0,0,0.3); margin-right: 1vh; }
    .pill.kerahat { background: rgba(255, 107, 107, 0.2); color: var(--danger); display: none; }

    /* Overlay */
    .overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.95);
      display: none; z-index: 100; flex-direction: column;
      align-items: center; justify-content: center;
    }
    .overlay.show { display: flex; }

    /* iPad 2 Yatay (Landscape) için 2 sütunlu düzen */
    @media (orientation: landscape) {
      .tiles-grid {
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(3, 1fr);
      }
      .t-time { font-size: 7vh; }
    }
  </style>
</head>
<body>

  <div class="wrap">
    <div class="header">
      <div class="title-area">
        <h1 id="cityTitle">Ankara</h1>
        <p id="dateLine">-- Şubat 2026</p>
        <div style="display:flex; margin-top:1vh;">
          <span class="pill" id="updatePill">Güncelleniyor...</span>
          <span class="pill kerahat" id="kerahatPill">⚠️ KERAHAT</span>
        </div>
      </div>
      <div class="clock" id="clock">00:00</div>
    </div>

    <div class="next-vakit">
      <div>
        <div style="font-size:1.8vh; color:var(--muted); font-weight:800;">SIRADAKİ</div>
        <div class="next-name" id="nextName">--</div>
      </div>
      <div style="text-align: right;">
        <div style="font-size:1.8vh; color:var(--muted); font-weight:800;">KALAN</div>
        <div class="countdown" id="countdown">00:00:00</div>
      </div>
    </div>

    <div class="tiles-grid" id="tilesGrid">
      </div>
  </div>

  <div class="overlay" id="overlay">
    <div style="font-size: 4vh; color: var(--muted);">VAKİT GİRDİ</div>
    <div style="font-size: 12vh; font-weight: 900; color: var(--accent);" id="ovName">--</div>
  </div>

<script>
(function(){
  const PRAYERS = [
    { key:"Imsak", tr:"İmsak" }, { key:"Gunes", tr:"Güneş" }, { key:"Ogle", tr:"Öğle" },
    { key:"Ikindi", tr:"İkindi" }, { key:"Aksam", tr:"Akşam" }, { key:"Yatsi", tr:"Yatsı" }
  ];

  let state = { data: null, lastMinute: -1 };
  const el = id => document.getElementById(id);
  const pad = n => String(n).padStart(2, '0');

  function loadData() {
    fetch(`vakit.json?v=${new Date().getTime()}`)
      .then(r => r.json())
      .then(json => {
        state.data = json;
        init();
      })
      .catch(() => {
        const cached = localStorage.getItem('cached_vakit');
        if(cached) {
          state.data = JSON.parse(cached);
          init();
        }
      });
  }

  function init() {
    renderTiles();
    loop();
    setInterval(loop, 1000);
  }

  function renderTiles() {
    el('tilesGrid').innerHTML = PRAYERS.map(p => `
      <div class="tile" id="tile-${p.key}">
        <div class="t-name">${p.tr}</div>
        <div class="t-time">${state.data.today[p.key]}</div>
      </div>
    `).join('');
    el('dateLine').textContent = state.data.today.MiladiTarihUzun || "";
    el('updatePill').textContent = "Veri: " + (state.data.generatedAt ? state.data.generatedAt.split('T')[1].substring(0,5) : "Tamam");
  }

  function loop() {
    const now = new Date();
    el('clock').textContent = pad(now.getHours()) + ":" + pad(now.getMinutes());
    
    const times = state.data.today;
    let next = null;
    const order = ["Imsak", "Ogle", "Ikindi", "Aksam", "Yatsi"];
    
    for (let key of order) {
      let [h, m] = times[key].split(':').map(Number);
      let t = new Date(now); t.setHours(h, m, 0, 0);
      if (t > now) { next = { k: key, t: t }; break; }
    }
    
    if (!next) {
      let tomorrow = new Date(now); tomorrow.setDate(tomorrow.getDate() + 1);
      let [h, m] = times.Imsak.split(':').map(Number);
      next = { k: "Imsak", t: new Date(tomorrow.setHours(h, m, 0, 0)) };
    }

    const diff = next.t - now;
    const h = Math.floor(diff / 3600000);
    const m = Math.floor((diff % 3600000) / 60000);
    const s = Math.floor((diff % 60000) / 1000);
    el('countdown').textContent = `${pad(h)}:${pad(m)}:${pad(s)}`;
    el('nextName').textContent = PRAYERS.find(p => p.key === next.k).tr;

    PRAYERS.forEach(p => el(`tile-${p.key}`).classList.remove('active'));
    el(`tile-${next.k}`).classList.add('active');

    if (now.getMinutes() !== state.lastMinute) {
      checkKerahat(now, times);
      state.lastMinute = now.getMinutes();
    }
  }

  function checkKerahat(now, times) {
    const [gh, gm] = times.Gunes.split(':').map(Number);
    const [ah, am] = times.Aksam.split(':').map(Number);
    const gunes = new Date(now).setHours(gh, gm, 0, 0);
    const aksam = new Date(now).setHours(ah, am, 0, 0);
    
    const isKerahat = (now > gunes && now < (gunes + 45*60000)) || 
                      (now > (aksam - 45*60000) && now < aksam);
    el('kerahatPill').style.display = isKerahat ? "inline-block" : "none";
  }

  loadData();
})();
</script>
</body>
</html>
